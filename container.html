

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Containers &mdash; Karabo-Pipeline 0.34.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=bbce7252"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples/examples.html" />
    <link rel="prev" title="Installation (User)" href="installation_user.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Users</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation_user.html">Installation (User)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Containers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#docker-images">Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#launch-a-docker-container">Launch a Docker Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="#singularity-containers">Singularity Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sarus-containers">Sarus Containers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallel_processing.html">Parallel processing with Karabo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Simulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="main_features/simulation.html">karabo.simulation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Imaging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="main_features/imaging.html">karabo.imaging.image</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_features/base_imaging.html">karabo.imaging.imager_base</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_features/oskar_imaging.html">karabo.imaging.imager_oskar</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_features/rascil_imaging.html">karabo.imaging.imager_rascil</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_features/wsclean_imaging.html">karabo.imaging.imager_wsclean</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Source Detection</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="main_features/sourcedetection.html">karabo.sourcedetection</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="utilities/utils.html">karabo.util package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Karabo-Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Containers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/container.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="containers">
<h1>Containers<a class="headerlink" href="#containers" title="Link to this heading"></a></h1>
<section id="docker-images">
<h2>Docker Images<a class="headerlink" href="#docker-images" title="Link to this heading"></a></h2>
<p>We provide for the Karabo-pipeline <a class="reference external" href="https://www.docker.com/resources/what-container/#:~:text=A%20Docker%20container%20image%20is,tools%2C%20system%20libraries%20and%20settings.">Docker images</a> which are hosted by the <a class="reference external" href="https://github.com/features/packages">ghcr.io</a> registry. An overview of all available images is <a class="reference external" href="https://github.com/i4ds/Karabo-Pipeline/pkgs/container/karabo-pipeline">here</a>, if a specific version and not simply <code class="docutils literal notranslate"><span class="pre">latest</span></code> is desired. Starting from <code class="docutils literal notranslate"><span class="pre">karabo&#64;v0.15.0</span></code>, all versions should be available. Provided you have docker, the image can be pulled as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>ghcr.io/i4ds/karabo-pipeline:latest
</pre></div>
</div>
<p>Docker images have the advantage that the packages needed for Karabo-pipeline are already pre-installed and you can usually run them on other operating systems. So in case the dependency resolving of older Karabo installations is not up to date anymore, with Docker images you don’t have to worry as the installation process has already been performed. In addition, Docker images can easily transform into other containers like Singularity or Sarus, which are often used in HPC-clusters.</p>
</section>
<section id="launch-a-docker-container">
<h2>Launch a Docker Container<a class="headerlink" href="#launch-a-docker-container" title="Link to this heading"></a></h2>
<p>What the possibilities using Docker are is far too extensive to describe here. We refer to the official <a class="reference external" href="https://docs.docker.com/reference/">Docker reference</a> for this. We only show here a minimal example of how Docker could be used, so you can use e.g. a <a class="reference external" href="https://jupyter.org/">Jupyter Notebook</a> with sample code and an existing Karabo environment.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span>&lt;local-dir&gt;:&lt;container-dir&gt;<span class="w"> </span>-p<span class="w"> </span>&lt;local-port&gt;:&lt;container-port&gt;<span class="w"> </span>&lt;registry&gt;/&lt;repository&gt;/&lt;image-name&gt;:&lt;tag&gt;<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span>&lt;command&gt;
</pre></div>
</div>
<p>which could results in something like launching a jupyter-notebook and destroying the container after termination:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span>ghcr.io/i4ds/karabo-pipeline:latest<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;jupyter lab --ip 0.0.0.0 --no-browser --allow-root --port=8888&#39;</span>
</pre></div>
</div>
<p>This starts a port-forwarded jupyter-lab server in the container, accessible through a browser using the printed URL. If you’re operating on a remote server, don’t forget to port-forwarding through SSH.</p>
<p>It isn’t recommended to just map the uid and gid through the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command, because for singularity compatibility we can’t create a custom user. However, just setting the ID’s would result in launched services like <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">lab</span></code> to lose permissions as root, which is needed to write service-specific files. Therefore, if you intend to add a writable mounted volume, you have to adjust the permissions by yourself.</p>
</section>
<section id="singularity-containers">
<h2>Singularity Containers<a class="headerlink" href="#singularity-containers" title="Link to this heading"></a></h2>
<p>Singularity containers are often standard on HPC clusters, which do not require special permissions (unlike Docker).
We do not provide ready-made <a class="reference external" href="https://sylabs.io/">Singularity containers</a>. However, they can be easily created from Docker images with the following command (may take a while). You may first have to load the module if it’s not available <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">singularity</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>singularity<span class="w"> </span>pull<span class="w"> </span>docker://ghcr.io/i4ds/karabo-pipeline
</pre></div>
</div>
<p>This creates a <code class="docutils literal notranslate"><span class="pre">.sif</span></code> file which acts as a singularity image and can be used to launch your application. How to use Singularity containers (e.g. mount directories or enable gpu-support) can be seen in the <a class="reference external" href="https://docs.sylabs.io/guides/3.1/user-guide/cli.html">Singularity documentation</a>. Be aware that Singularity mounts the home-directory by default if start a container from your home-directory, which may or may not be desirable (e.g. <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code> of your home instead of the container could get executed if you execute a Singularity container interactively). Therefore, for interactive access of a Karabo Singularity container, we suggest to use the <code class="docutils literal notranslate"><span class="pre">--no-home</span></code> flag.</p>
</section>
<section id="sarus-containers">
<h2>Sarus Containers<a class="headerlink" href="#sarus-containers" title="Link to this heading"></a></h2>
<p>On CSCS, it is recommended to use <a class="reference external" href="https://sarus.readthedocs.io/en/stable/index.html">Sarus containers</a> (see CSCS <a class="reference external" href="https://user.cscs.ch/tools/containers/sarus/">Sarus guide</a>). Sarus commands are similar to Docker or Singularity. It is recommended to create a Sarus image in an interactive SLURM job using <code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">--pty</span> <span class="pre">bash</span></code>.</p>
<p><strong>Setup</strong></p>
<p>On daint, you should load <code class="docutils literal notranslate"><span class="pre">daint-gpu</span></code> or <code class="docutils literal notranslate"><span class="pre">daint-mc</span></code> before loading the <code class="docutils literal notranslate"><span class="pre">sarus</span></code> modulefile. We haven’t tested the setup on alps. This is supposed to be done at some point.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>load<span class="w"> </span>daint-gpu<span class="w"> </span><span class="se">\#</span><span class="w"> </span>or<span class="w"> </span>daint-mc
module<span class="w"> </span>load<span class="w"> </span>sarus
</pre></div>
</div>
<p>Then you can pull a Docker image to a Sarus image as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sarus<span class="w"> </span>pull<span class="w"> </span>ghcr.io/i4ds/karabo-pipeline
</pre></div>
</div>
<p><strong>MPI (MPICH) Support</strong></p>
<p>Karabo &gt;= <code class="docutils literal notranslate"><span class="pre">v0.22.0</span></code> supports <a class="reference external" href="https://www.mpich.org/">MPICH</a>-based MPI processes that enable multi-node workflows on CSCS (or any other system which supports MPICH MPI). Note, on CSCS, mpi-runs are launched through SLURM (not through mpirun or mpiexec) by setting the <code class="docutils literal notranslate"><span class="pre">-n</span></code> (total-mpi-tasks) and <code class="docutils literal notranslate"><span class="pre">-N</span></code> (mpi-tasks-per-node) options when launching a job. So you have to set them according to your task.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>srun<span class="w"> </span>-N2<span class="w"> </span>-n2<span class="w"> </span>-C<span class="w"> </span>gpu<span class="w"> </span>sarus<span class="w"> </span>run<span class="w"> </span>--mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>&lt;your_repo&gt;,destination<span class="o">=</span>/workspace<span class="w"> </span>ghcr.io/i4ds/karabo-pipeline<span class="w"> </span>&lt;mpi_application&gt;
</pre></div>
</div>
<p>Here, an MPI application with 2 processes is launched with your repository mounted in the container. Make sure that you know how many processes are reasonable to run because it can rapidly sum up to a large number of nodehours.</p>
<p>Sarus containers allow native mpi-hook to utilize the mpi of CSCS at optimized performance. This can be done by simply adding the <code class="docutils literal notranslate"><span class="pre">--mpi</span></code> flag to the sarus run command. Probably, there will be some warning about the minor version of some libmpi-files. However, according to <a class="reference external" href="https://sarus.readthedocs.io/en/stable/user/abi_compatibility.html">sarus abi-compatibility</a> this shouldn’t be an issue.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation_user.html" class="btn btn-neutral float-left" title="Installation (User)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples/examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, i4ds.
      <span class="lastupdated">Last updated on Oct 09, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>